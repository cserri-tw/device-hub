// Copyright Â© 2017 thingful

syntax = "proto3";

option java_multiple_files = true;
option java_package = "io.thingful.devicehub";
option java_outer_classname = "DeviceHubProto";

package proto;

//import "google/protobuf/timestamp.proto";

service Hub {

  // add a pipe to an existing listener and endpoint 
  rpc PipeAdd (PipeAddRequest) returns (PipeAddReply) {}

  // delete pipe by URI
  rpc PipeDelete (PipeDeleteRequest) returns (PipeDeleteReply) {}

  // list all running pipes
  rpc PipeList (PipeListRequest) returns (PipeListReply) {}
}

message PipeAddRequest {
    string uri = 1;
    string profile_uid = 2;
    string listener_uid = 3;
    repeated string endpoint_uids = 4;
}

message PipeAddReply {
    bool ok = 1;
    string error = 2;
}

message PipeDeleteRequest {
    string uri = 1;
}

message PipeDeleteReply {
    bool ok = 1;
    string error = 2;
}

message PipeListRequest {
}

message PipeListReply {
  repeated Pipe pipes = 1;
}

message Pipe {
  string uri = 1;
  // TODO : reinstate
  //google.protobuf.Timestamp started = 2;
  PipeState state = 2;
  Profile profile = 3;
  Endpoint listener = 4;
  Statistics message_stats = 5;

  repeated Endpoint endpoints = 6;
}

message Endpoint {
    string uid = 1;
    string type = 2;
}

message Profile {
    string name = 1;
    string description = 2;
    string version = 3;
}

message Statistics {
    uint64 total = 1;
    uint64 errors = 2;
    uint64 ok = 3;
}

enum PipeState {
    UNKNOWN = 0;
    RUNNING = 1;
    STOPPED = 2;
    ERRORED = 3;
}
